!function(t){"use strict";var e=function(t,A){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var A in e)Object.prototype.hasOwnProperty.call(e,A)&&(t[A]=e[A])})(t,A)};var A,i=function(){return(i=Object.assign||function(t){for(var e,A=1,i=arguments.length;A<i;A++)for(var n in e=arguments[A])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};!function(t){t.TIMEUPDATE="timeupdate",t.SUSPEND="suspend",t.ERROR="error",t.WAITING="waiting",t.PLAYING="playing",t.CANPLAY="canplay",t.ENDED="ended"}(A||(A={}));var n=function(){function t(t,e){this.$callBack=null,this.$eventNameList=[A.TIMEUPDATE,A.SUSPEND,A.ERROR,A.WAITING,A.PLAYING,A.CANPLAY,A.ENDED],this.$callBack=e,this.$video=t}return t.prototype.init=function(){this.initStyle(this.$video),this.initEvent(this.$video)},t.prototype.destroy=function(){var t=this,e=this.onVideoEvent;this.$eventNameList.forEach((function(A){t.$video.removeEventListener(A,e)}))},t.prototype.initStyle=function(t){this.addStyle(" .IIV::-webkit-media-controls-play-button,   .IIV::-webkit-media-controls-start-playback-button {  opacity: 0;    pointer-events: none;    width: 5px;}"),t.setAttribute("preload","auto"),t.setAttribute("x-webkit-airplay","true"),t.setAttribute("airplay","allow"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("playsinline","true")},t.prototype.addStyle=function(t){var e=document.getElementsByTagName("head")[0],A=document.createElement("style"),i=document.createTextNode(t);A.type="text/css",A.appendChild(i),e.appendChild(A)},t.prototype.initEvent=function(t){var e=this;this.onVideoEvent=this.onVideoEvent.bind(this),this.$eventNameList.forEach((function(A){t.addEventListener(A,e.onVideoEvent)}))},t.prototype.onVideoEvent=function(t){this.$callBack(t)},t}();var o,r=(function(t){var e=Object.prototype.hasOwnProperty,A="~";function i(){}function n(t,e,A){this.fn=t,this.context=e,this.once=A||!1}function o(t,e,i,o,r){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new n(i,o||t,r),a=A?A+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function r(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(A=!1)),s.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(A?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},s.prototype.listeners=function(t){var e=A?A+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,r=new Array(o);n<o;n++)r[n]=i[n].fn;return r},s.prototype.listenerCount=function(t){var e=A?A+t:t,i=this._events[e];return i?i.fn?1:i.length:0},s.prototype.emit=function(t,e,i,n,o,r){var s=A?A+t:t;if(!this._events[s])return!1;var a,l,c=this._events[s],p=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),p){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,n),!0;case 5:return c.fn.call(c.context,e,i,n,o),!0;case 6:return c.fn.call(c.context,e,i,n,o,r),!0}for(l=1,a=new Array(p-1);l<p;l++)a[l-1]=arguments[l];c.fn.apply(c.context,a)}else{var d,u=c.length;for(l=0;l<u;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),p){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,i);break;case 4:c[l].fn.call(c[l].context,e,i,n);break;default:if(!a)for(d=1,a=new Array(p-1);d<p;d++)a[d-1]=arguments[d];c[l].fn.apply(c[l].context,a)}}return!0},s.prototype.on=function(t,e,A){return o(this,t,e,A,!1)},s.prototype.once=function(t,e,A){return o(this,t,e,A,!0)},s.prototype.removeListener=function(t,e,i,n){var o=A?A+t:t;if(!this._events[o])return this;if(!e)return r(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||n&&!s.once||i&&s.context!==i||r(this,o);else{for(var a=0,l=[],c=s.length;a<c;a++)(s[a].fn!==e||n&&!s[a].once||i&&s[a].context!==i)&&l.push(s[a]);l.length?this._events[o]=1===l.length?l[0]:l:r(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=A?A+t:t,this._events[e]&&r(this,e)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=A,s.EventEmitter=s,t.exports=s}(o={exports:{}},o.exports),o.exports);var s,a="具体用法请参考 https://tgideas.qq.com/doc/frontend/component/m/mmd.html";t.VideoEvent=void 0,(s=t.VideoEvent||(t.VideoEvent={})).START="start",s.END="end",s.CUE_POINT="cuePoint",s.WAITING="waiting",s.PLAYING="playing",s.LOAD_PROGRESS="loadProgress",s.LOAD_COMPLETE="loadComplete",s.ERROR="error";var l={poster:"",src:"",cuePoints:[],muted:!1,loop:!1,timesParam:[],visibilityHandle:!0},c=function(o){function r(t){var e=o.call(this)||this;return e.options=t,e._videoSrc="",e._preload=!1,e._firstPlay=!0,e._paused=!0,e.options=i(i({},l),t),e.options?e.options.videoElement?(e.videoElement=e.options.videoElement,e.src=e.options.src,e._allCuePoints=e.options.cuePoints.concat(e.options.timesParam),e.onVideoEvent=e.onVideoEvent.bind(e),e._videoHelper=new n(e.options.videoElement,e.onVideoEvent),e._videoHelper.init(),e.visibilityChangeEventInit(),e):(console.error("videoElement 为必填参数,不允许为空 "+a),e):(console.error("参数,不允许为空 "+a),e)}return function(t,A){if("function"!=typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function i(){this.constructor=t}e(t,A),t.prototype=null===A?Object.create(A):(i.prototype=A.prototype,new i)}(r,o),Object.defineProperty(r.prototype,"isVideoCanAutoPlay",{get:function(){return console.error("视频自动播放存在兼容问题,无法做到兼容所有情况,已废弃,不建议再使用"),!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,this._paused?this.pause():this.play()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"duration",{get:function(){return this.options.videoElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ended",{get:function(){return this.options.videoElement.ended},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cuePoints",{get:function(){return this.options.cuePoints},set:function(t){this.options.cuePoints=t,this._allCuePoints=this.options.cuePoints.concat(this.options.timesParam),this.resetCuePoints()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"timesParam",{get:function(){return this.options.timesParam},set:function(t){this.options.timesParam=t,this._allCuePoints=this.options.cuePoints.concat(this.options.timesParam),this.resetCuePoints()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"poster",{get:function(){return this.options.poster},set:function(t){this.options.videoElement.poster=t,this.options.poster=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"muted",{get:function(){return this.options.muted},set:function(t){this.options.videoElement.muted=t,this.options.muted=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"loop",{get:function(){return this.options.loop},set:function(t){this.options.loop=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this.options.videoElement.currentTime},set:function(t){this.options.videoElement.currentTime=t,this.resetCuePoints()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"videoSrc",{get:function(){return this._videoSrc},set:function(t){this.options.videoElement.src=t,this._videoSrc=t},enumerable:!1,configurable:!0}),r.prototype.play=function(){this._preload=!1,this.setSrc(),this.options.videoElement.play().then(),this._paused=!1},r.prototype.preload=function(){this.setSrc(),this.loadVideo()},r.prototype.stopPreload=function(){this._preload=!1,this.videoSrc=""},r.prototype.pause=function(){this.options.videoElement.pause(),this._paused=!0},r.prototype.replay=function(){this.resetCuePoints(),this.currentTime=0,this.play()},r.prototype.activeVideo=function(){this.videoSrc="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAr9tZGF0AAACoAYF//+c3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDEyNSAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTIgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0xIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMTMgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTEgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MyBiX3B5cmFtaWQ9MiBiX2FkYXB0PTEgYl9iaWFzPTAgZGlyZWN0PTEgd2VpZ2h0Yj0xIG9wZW5fZ29wPTAgd2VpZ2h0cD0yIGtleWludD0yNTAga2V5aW50X21pbj0yNCBzY2VuZWN1dD00MCBpbnRyYV9yZWZyZXNoPTAgcmNfbG9va2FoZWFkPTQwIHJjPWNyZiBtYnRyZWU9MSBjcmY9MjMuMCBxY29tcD0wLjYwIHFwbWluPTAgcXBtYXg9NjkgcXBzdGVwPTQgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAA9liIQAV/0TAAYdeBTXzg8AAALvbW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAAACoAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAhl0cmFrAAAAXHRraGQAAAAPAAAAAAAAAAAAAAABAAAAAAAAACoAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAgAAAAIAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAqAAAAAAABAAAAAAGRbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAAwAAAAAgBVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAABPG1pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAPxzdGJsAAAAmHN0c2QAAAAAAAAAAQAAAIhhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAgACABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAMmF2Y0MBZAAK/+EAGWdkAAqs2V+WXAWyAAADAAIAAAMAYB4kSywBAAZo6+PLIsAAAAAYc3R0cwAAAAAAAAABAAAAAQAAAgAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACtwAAAAEAAAAUc3RjbwAAAAAAAAABAAAAMAAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTQuNjMuMTA0",this.loadVideo()},r.prototype.destroy=function(){this._videoHelper.destroy(),this.removeVisibilityChangeEvent(),this.stopPreload(),this.options.videoElement=null,this._paused=!0},r.prototype.visibilityChangeEventInit=function(){this.onVisibilitychangeEventHandler=this.onVisibilitychangeEventHandler.bind(this),this.qbrowserVisibilityChangeEventHandler=this.qbrowserVisibilityChangeEventHandler.bind(this),document.addEventListener("visibilitychange",this.onVisibilitychangeEventHandler),document.addEventListener("qbrowserVisibilityChange",this.qbrowserVisibilityChangeEventHandler)},r.prototype.removeVisibilityChangeEvent=function(){document.removeEventListener("visibilitychange",this.onVisibilitychangeEventHandler),document.removeEventListener("qbrowserVisibilityChange",this.qbrowserVisibilityChangeEventHandler)},r.prototype.qbrowserVisibilityChangeEventHandler=function(t){this.options.visibilityHandle&&this.hiddenHandler(t.hidden)},r.prototype.onVisibilitychangeEventHandler=function(){if(this.options.visibilityHandle)switch(document.visibilityState){case"hidden":this.hiddenHandler(!0);break;case"visible":this.hiddenHandler(!1)}},r.prototype.hiddenHandler=function(t){t?this.paused||this.videoElement.pause():this.paused||this.videoElement.play()},r.prototype.setSrc=function(){this.src&&""!==this.src?this.videoSrc!=this.src&&(this._firstPlay=!0,this.videoSrc=this.src,this._paused=!0,this.resetCuePoints()):console.error("src不能为空")},r.prototype.loadVideo=function(){""===this.videoSrc&&console.error("video.src不能为空值"),this._preload=!0,navigator.userAgent.indexOf("Android")>-1||navigator.userAgent.indexOf("Adr")>-1?this.options.videoElement.play().then():this.options.videoElement.load()},r.prototype.onVideoEvent=function(e){var i,n,o,r,s,a;switch(e.type){case A.TIMEUPDATE:this._preload||this.timeUpdateHandler();break;case A.SUSPEND:this.updateBuffered();break;case A.ERROR:this._preload||""==this.videoSrc||(this.emit(t.VideoEvent.ERROR,e.target.error),null===(n=null===(i=this.options)||void 0===i?void 0:i.onError)||void 0===n||n.call(i,e.target.error));break;case A.WAITING:this._preload||this._firstPlay||(this.emit(t.VideoEvent.WAITING),null===(r=null===(o=this.options)||void 0===o?void 0:o.onWaiting)||void 0===r||r.call(o));break;case A.PLAYING:this._preload||this._firstPlay||(this.emit(t.VideoEvent.PLAYING),null===(a=null===(s=this.options)||void 0===s?void 0:s.onPlaying)||void 0===a||a.call(s));break;case A.CANPLAY:this._preload&&this.pause();break;case A.ENDED:this.onEndedHandler()}},r.prototype.updateBuffered=function(){var e,A,i,n,o=this.options.videoElement,r=o.buffered,s=o.duration;if(r.length>0){var a=r.end(r.length-1)/s;this.emit(t.VideoEvent.LOAD_PROGRESS,Number(a.toFixed(3))),null===(A=null===(e=this.options)||void 0===e?void 0:e.onLoadedProgress)||void 0===A||A.call(e,Number(a.toFixed(3))),a>=1&&(this.emit(t.VideoEvent.LOAD_COMPLETE),null===(n=null===(i=this.options)||void 0===i?void 0:i.onLoadedComplete)||void 0===n||n.call(i))}},r.prototype.timeUpdateHandler=function(){var e,A;this._firstPlay&&this.options.videoElement.currentTime>0&&(this._firstPlay=!1,this.emit(t.VideoEvent.START),null===(A=null===(e=this.options)||void 0===e?void 0:e.onStart)||void 0===A||A.call(e)),this.checkCuePoints()},r.prototype.onEndedHandler=function(){var e,A;this.emit(t.VideoEvent.END),null===(A=null===(e=this.options)||void 0===e?void 0:e.onEnd)||void 0===A||A.call(e),this.loop&&this.replay()},r.prototype.resetCuePoints=function(){this._allCuePoints&&this._allCuePoints.forEach((function(t){t.trigger=!1}))},r.prototype.checkCuePoints=function(){var e=this;if(this._allCuePoints){var A=this.options.videoElement.currentTime;this._allCuePoints.forEach((function(i){var n,o;if(!i.trigger&&e.compared(A,i.time)){i.trigger=!0;var r=i.name,s=i.time;e.emit(t.VideoEvent.CUE_POINT,r,s),null===(o=null===(n=e.options)||void 0===n?void 0:n.onTimes)||void 0===o||o.call(n,r,s)}}))}},r.prototype.compared=function(t,e){return t-.03<e&&t+.03*15>e},r}(r);t.VideoPlayer=c,Object.defineProperty(t,"__esModule",{value:!0})}(this.MMD=this.MMD||{});
